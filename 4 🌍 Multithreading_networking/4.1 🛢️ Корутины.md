# üõ¢Ô∏è –ö–æ—Ä—É—Ç–∏–Ω—ã –≤ Android

## üì± –í–≤–µ–¥–µ–Ω–∏–µ

**–ö–æ—Ä—É—Ç–∏–Ω—ã (Coroutines)** - —ç—Ç–æ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Å–ø–æ—Å–æ–± —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º–∏ –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏ –≤ Kotlin, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—â–∏–π –ø—Ä–æ—Å—Ç–æ–π –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –∫ –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ–º—É –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—é.
–û–Ω–∏ –ø–æ–∑–≤–æ–ª—è—é—Ç –ø–∏—Å–∞—Ç—å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∫–æ–¥ —Ç–∞–∫, –∫–∞–∫ –µ—Å–ª–∏ –±—ã –æ–Ω –±—ã–ª —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º.

````kotlin
import kotlinx.coroutines.*

fun main() {
    GlobalScope.launch { // –∑–∞–ø—É—Å–∫–∞–µ—Ç –Ω–æ–≤—É—é –∫–æ—Ä—É—Ç–∏–Ω—É –≤ –≥–ª–æ–±–∞–ª—å–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏ –±–µ–∑ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
        delay(1000L) // –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç –ø–æ—Ç–æ–∫ –Ω–∞ 1 —Å–µ–∫—É–Ω–¥—É
        println("World!") // –≤—ã–≤–æ–¥–∏—Ç—Å—è –ø–æ—Å–ª–µ –∑–∞–¥–µ—Ä–∂–∫–∏
    }
    println("Hello,") // –≤—ã–≤–æ–¥–∏—Ç—Å—è —Å—Ä–∞–∑—É
    runBlocking {     // –±–ª–æ–∫–∏—Ä—É–µ—Ç –æ—Å–Ω–æ–≤–Ω–æ–π –ø–æ—Ç–æ–∫ –Ω–∞ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
        delay(2000L)  // –∂–¥–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö –∫–æ—Ä—É—Ç–∏–Ω –≤ —ç—Ç–æ–º –±–ª–æ–∫–µ
    }
}
````

–†–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–¥–∞ –±—É–¥–µ—Ç —Å–ª–µ–¥—É—é—â–∏–º:

````text
Hello,
World!
````

## üõ† –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

````kotlin
dependencies {
    implementation("org.jetbrains.kotlinx:kotlinx-coroutines-android:1.10.1")
    implementation("org.jetbrains.kotlinx:kotlinx-coroutines-core:1.10.1")
    
    // –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
    testImplementation("org.jetbrains.kotlinx:kotlinx-coroutines-test:1.10.1")
}
````

## üéØ –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏

### 1. –ö–æ—Ä—É—Ç–∏–Ω—ã –∏ –æ–±–ª–∞—Å—Ç–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏ (Scopes)

````kotlin
class MainActivity : AppCompatActivity() {
    // Scope –ø—Ä–∏–≤—è–∑–∞–Ω–Ω—ã–π –∫ –∂–∏–∑–Ω–µ–Ω–Ω–æ–º—É —Ü–∏–∫–ª—É Activity
    private val scope = lifecycleScope
    
    // Scope –¥–ª—è ViewModel
    class MyViewModel : ViewModel() {
        private val scope = viewModelScope
    }
    
    // –ì–ª–æ–±–∞–ª—å–Ω—ã–π scope (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ—Å—Ç—å—é)
    GlobalScope.launch {
        // –î–æ–ª–≥–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è
    }
}
````

### 2. –ö–æ–Ω—Ç–µ–∫—Å—Ç –∏ –¥–∏—Å–ø–µ—Ç—á–µ—Ä—ã

````kotlin
// –†–∞–∑–ª–∏—á–Ω—ã–µ –¥–∏—Å–ø–µ—Ç—á–µ—Ä—ã
CoroutineScope(Dispatchers.Main) // UI –æ–ø–µ—Ä–∞—Ü–∏–∏
CoroutineScope(Dispatchers.IO) // –í–≤–æ–¥/–≤—ã–≤–æ–¥, —Å–µ—Ç—å
CoroutineScope(Dispatchers.Default) // CPU-–∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
CoroutineScope(Dispatchers.Unconfined) // –ë–µ–∑ –ø—Ä–∏–≤—è–∑–∫–∏ –∫ –ø–æ—Ç–æ–∫—É
````

### 3. Job –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

````kotlin
class ExampleClass {
    private val job = Job()
    private val scope = CoroutineScope(Dispatchers.Main + job)
    
    fun startOperation() {
        scope.launch {
            try {
                // –î–ª–∏—Ç–µ–ª—å–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è
            } catch (e: CancellationException) {
                // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–º–µ–Ω—ã
            }
        }
    }
    
    fun cancelOperation() {
        job.cancel() // –û—Ç–º–µ–Ω–∞ –≤—Å–µ—Ö –∫–æ—Ä—É—Ç–∏–Ω –≤ scope
    }
}
````

## üí° –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–º–µ—Ä—ã

### 1. –ë–∞–∑–æ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

````kotlin
class BasicExample {
    private val scope = CoroutineScope(Dispatchers.Main)
    
    fun loadData() {
        scope.launch {
            val result = withContext(Dispatchers.IO) {
                // –ò–º–∏—Ç–∞—Ü–∏—è —Å–µ—Ç–µ–≤–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
                delay(1000)
                "–î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã"
            }
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI
            updateUI(result)
        }
    }
}
````

### 2. –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ

````kotlin
suspend fun loadParallel() = coroutineScope {
    val deferred1 = async { loadFirstPart() }
    val deferred2 = async { loadSecondPart() }
    
    val result1 = deferred1.await()
    val result2 = deferred2.await()
    
    "$result1 $result2"
}
````

### 3. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

````kotlin
class ErrorHandlingExample {
    fun handleErrors() {
        viewModelScope.launch {
            try {
                val result = withContext(Dispatchers.IO) {
                    throw Exception("–°–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞")
                }
            } catch (e: Exception) {
                // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏
            } finally {
                // –û—á–∏—Å—Ç–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤
            }
        }
    }
}
````

### 4. Flow

````kotlin
class FlowExample {
    private val _dataFlow = MutableStateFlow<String>("")
    val dataFlow = _dataFlow.asStateFlow()
    
    fun startDataStream() {
        viewModelScope.launch {
            flow {
                repeat(10) {
                    delay(1000)
                    emit("–î–∞–Ω–Ω—ã–µ $it")
                }
            }
            .catch { e -> 
                // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
            }
            .collect { value ->
                _dataFlow.value = value
            }
        }
    }
}
````

## üé® –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ UI

### 1. –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö

````kotlin
@Composable
fun LoadingScreen(
    viewModel: LoadingViewModel = viewModel()
) {
    val state by viewModel.state.collectAsState()
    
    when (state) {
        is UiState.Loading -> LoadingIndicator()
        is UiState.Success -> ContentView(state.data)
        is UiState.Error -> ErrorView(state.message)
    }
}
````

### 2. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

````kotlin
@Composable
fun RealTimeUpdates() {
    var count by remember { mutableStateOf(0) }
    val scope = rememberCoroutineScope()
    
    LaunchedEffect(Unit) {
        while (true) {
            delay(1000)
            count++
        }
    }
    
    Text("–°—á—ë—Ç—á–∏–∫: $count")
}
````

## ‚ö†Ô∏è –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏

### 1. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–∞–º–∏

* –í—Å–µ–≥–¥–∞ –æ—Ç–º–µ–Ω—è–π—Ç–µ –∫–æ—Ä—É—Ç–∏–Ω—ã –ø—Ä–∏ —É–Ω–∏—á—Ç–æ–∂–µ–Ω–∏–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
* –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–æ–¥—Ö–æ–¥—è—â–∏–µ scope
* –ü—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–π—Ç–µ –æ—à–∏–±–∫–∏

### 2. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

* –í—ã–±–∏—Ä–∞–π—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –¥–∏—Å–ø–µ—Ç—á–µ—Ä
* –ò–∑–±–µ–≥–∞–π—Ç–µ –±–ª–æ–∫–∏—Ä—É—é—â–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
* –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—É—é –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç—å

### 3. –û—Ç–ª–∞–¥–∫–∞

* –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∏–º–µ–Ω–∞ –¥–ª—è –∫–æ—Ä—É—Ç–∏–Ω
* –õ–æ–≥–∏—Ä—É–π—Ç–µ –≤–∞–∂–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è
* –ü—Ä–∏–º–µ–Ω—è–π—Ç–µ –∫–æ—Ä—É—Ç–∏–Ω—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

## üìö –ü–æ–ª–µ–∑–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

* [–û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](https://kotlinlang.org/docs/coroutines-overview.html)
* [–û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –≥–∏—Ç—Ö–∞–± —Å–æ —Å–≤–µ–∂–µ–π –≤–µ—Ä—Å–∏–µ–π –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–µ–π](https://github.com/Kotlin/kotlinx.coroutines)
* [Android Coroutines Guide](https://developer.android.com/kotlin/coroutines)
* [–ü–æ–¥—Ä–æ–±–Ω–∞—è —Å—Ç–∞—Ç—å—è –Ω–∞ Habr](https://habr.com/ru/articles/838974/)
* [Coroutines Best Practices](https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines/-coroutine-scope/)

## üé• –í–∏–¥–µ–æ –º–∞—Ç–µ—Ä–∏–∞–ª—ã

[![Watch the video](https://img.youtube.com/vi/YD2GeSEJQtI/0.jpg)](https://www.youtube.com/watch?v=YD2GeSEJQtI&pp=ygUYYW5kcm9pZCDQutC-0YDRg9GC0LjQvdGL)

[![Watch the video](https://img.youtube.com/vi/hocpaSjrS84/0.jpg)](https://youtu.be/hocpaSjrS84?list=PLXtiZNKIobF5E1JgDaisqnVJfbZeUFYkm)

[![Watch the video](https://img.youtube.com/vi/mkumPx2ra5Q/0.jpg)](https://youtu.be/mkumPx2ra5Q?list=PLIh9yLdjK2YeRLnD-gJyVWIq_w-7OMv8r)
